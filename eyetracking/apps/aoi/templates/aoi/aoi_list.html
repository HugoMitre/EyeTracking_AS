{% extends "base.html" %}
{% load staticfiles %}
{% load render_table from django_tables2 %}

{% block head_files %}
    <script src="{% static 'js/plugins/fabric/fabric.min.js' %}"></script>
{% endblock %}

{% block title %} Manage AOIs {% endblock %}

{% block menu %}
    {% include 'menu.html' with active_menu='aoi' %}
{% endblock %}

{% block page_title %} Manage AOIs {% endblock %}

{% block actions %}
    <a class="btn btn-success" href="{% url 'aoi:create' %}" role="button"><i class="glyphicon glyphicon-plus"></i> Create</a>
{% endblock %}

{% block content %}
    {% render_table table "table.html" %}
    <canvas id="canvas" width="500" height="500" style="border:1px dotted #ccc"></canvas><br><br>
{% endblock %}

{% block body_files %}
    <script>
        // create a wrapper around native canvas element (with id="c")

        var canvas = new fabric.Canvas('canvas');
        canvas.observe('mouse:down', function(e) { mousedown(e); });
        canvas.observe('mouse:move', function(e) { mousemove(e); });
        canvas.observe('mouse:up', function(e) { mouseup(e); });

        var started = false;
        var x = 0;
        var y = 0;

        /* Mousedown */
        function mousedown(e) {
            var mouse = canvas.getPointer(e.e);
            started = true;
            x = mouse.x;
            y = mouse.y;

            var square = new fabric.Rect({
                width: 0,
                height: 0,
                left: x,
                top: y,
                fill: 'red'
            });

            canvas.add(square);
            canvas.renderAll();
            canvas.setActiveObject(square);

        }


        /* Mousemove */
        function mousemove(e) {
            if(!started) {
                return false;
            }

            var mouse = canvas.getPointer(e.e);

            var w = Math.abs(mouse.x - x),
            h = Math.abs(mouse.y - y);

            if (!w || !h) {
                return false;
            }

            var square = canvas.getActiveObject();
            square.set('width', w).set('height', h);
            canvas.renderAll();
        }

        /* Mouseup */
        function mouseup(e) {
            if(started) {
                started = false;
            }

            var square = canvas.getActiveObject();

            canvas.add(square);
            canvas.renderAll();
         }

    </script>
{% endblock %}